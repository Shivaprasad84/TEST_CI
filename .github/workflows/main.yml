name: Build and Run

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: git clone
      run: git clone https://github.com/eclipse/paho.mqtt.c.git
    
    - name: build
      run:  |
            cd paho.mqtt.c
            make -j
            sudo make install

    - name: build subscriber and publisher
      run: |
            cd paho.mqtt.c/src/samples
            gcc MQTTAsync_subscribe.c -o MQTTAsync_subscribe -lpaho-mqtt3as
            gcc MQTTAsync_publish.c -o MQTTAsync_publish -lpaho-mqtt3as
      
    - name: run subscriber and publisher
      run: |
           cd paho.mqtt.c/src/samples
           ./MQTTAsync_subscribe 
           ./MQTTAsync_publish